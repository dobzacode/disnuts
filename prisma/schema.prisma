generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url = env("POSTGRES_PRISMA_URL") 
  directUrl = env("POSTGRES_URL_NON_POOLING") 
}

model User {
  user_id      String       @id @default(uuid())
  username     String    @unique
  email        String    @unique
  password String
  createdAt DateTime @default(now())
  communities  CommunityUser[]
  posts        Post[]
  comments     Comment[]
  votes        Vote[]
}

model Community {
  community_id   String       @id @default(uuid())
  name            String
  description    String
  createdAt DateTime  @default(now())
  admin    CommunityUser[]
  posts          Post[]
}

enum Role {
    ADMIN
    GUEST
}

model CommunityUser {
  community_user_id String       @id @default(uuid())
  role Role @default(GUEST)

  user       User      @relation(fields: [user_id], references: [user_id])
  user_id String 

  community        Community @relation(fields: [community_id], references: [community_id])
  community_id String

  joinedAt DateTime  @default(now())
}

model Post {
  post_id         String       @id @default(uuid())
  title           String
  content         String
  createdAt DateTime  @default(now())

  author          User      @relation(fields: [author_id], references: [user_id])
  author_id String

  community    Community @relation(fields: [community_id], references: [community_id])
  community_id String

  comments        Comment[]
  votes           Vote[]
}


model Comment {
  comment_id      String       @id @default(uuid())
  contenu         String
  createdAt       DateTime     @default(now())

  auteur          User         @relation(fields: [author_id], references: [user_id])
  author_id       String

  post            Post         @relation(fields: [post_id], references: [post_id])
  post_id         String

  parent_comment  Comment?     @relation("ReponseA", fields: [parent_comment_id], references: [comment_id])
  parent_comment_id String?

  votes           Vote[]
  
  child_comments  Comment[]    @relation("ReponseA")
}


// Mod√®le pour les votes
model Vote {
  vote_id         String       @id @default(uuid())
  type            String
  date_de_creation DateTime  @default(now())
  auteur          User      @relation(fields: [author_id], references: [user_id])
  author_id String

  post            Post      @relation(fields: [post_id], references: [post_id])
  post_id String

  comments Comment[]
}
